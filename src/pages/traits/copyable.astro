---
import SidebarLayout from '../../layouts/SidebarLayout.astro';

const eventDetail = `{ value: string }`;
const codeExamples = {
  basicCopyInjection: `&lt;copy-demo traits="copyable pressable"
  copyable-value="npm install native-ui"&gt;
  &lt;span class="copy-label"&gt;npm install native-ui&lt;/span&gt;
  &lt;span class="copy-indicator"&gt;Copy&lt;/span&gt;
&lt;/copy-demo&gt;

// Minimal UIElement shell
class CopyDemo extends UIElement {}
define('copy-demo', CopyDemo);

// Wire ui-press → copy
el.addEventListener('ui-press', () =&gt; {
  el.getTraitController('copyable')?.copy();
});`,
  copyWithGetter: `import { CopyController } from '@nonoun/native-ui';

const el = document.querySelector('#getter-demo');
const copy = new CopyController(el, {
  value: () =&gt; new Date().toISOString(),
});

el.addEventListener('ui-press', () =&gt; copy.copy());`,
};
---
<SidebarLayout title="Copyable">
  <main>
<h1>Copyable</h1>
    <p style="color: var(--neutral-ink-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
      One-click copy-to-clipboard with visual confirmation feedback. Sets the <code>[copied]</code> attribute during the feedback window and dispatches <code>ui-copy</code>.
    </p>

    <!-- ── Basic Copy (Injection) ── -->

    <h2>Basic Copy <span class="pattern-badge injection">Injection</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>traits="copyable pressable"</code> on a minimal UIElement shell. Click triggers copy via <code>ui-press</code>. The <code>[copied]</code> attribute provides visual feedback for 2 seconds.
      </p>
      <copy-demo traits="copyable pressable" copyable-value="npm install native-ui" class="copy-card">
        <span class="copy-label">npm install native-ui</span>
        <span class="copy-indicator"><ui-icon name="copy"></ui-icon> Copy</span>
      </copy-demo>
      <div id="basic-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.basicCopyInjection} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Copy with Getter ── -->

    <h2>Copy with Getter</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        The copyable adapter takes static <code>value</code> strings. For dynamic values (like timestamps), use <code>CopyController</code> directly with a getter function.
      </p>
      <copy-demo id="getter-demo" traits="pressable" class="copy-card">
        <span class="copy-label">Copy current timestamp</span>
        <span class="copy-indicator"><ui-icon name="copy"></ui-icon> Copy</span>
      </copy-demo>
      <div id="getter-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.copyWithGetter} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Custom Duration (Injection) ── -->

    <h2>Custom Duration (500ms) <span class="pattern-badge injection">Injection</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>copyable-feedback-duration="500"</code> for quick feedback instead of the default 2000ms.
      </p>
      <copy-demo traits="copyable pressable" copyable-value="Quick feedback copy" copyable-feedback-duration="500" class="copy-card">
        <span class="copy-label">Quick feedback copy</span>
        <span class="copy-indicator"><ui-icon name="copy"></ui-icon> Copy</span>
      </copy-demo>
      <div id="fast-log" class="output"></div>
      <pre class="layout-code"><code>&lt;copy-demo traits="copyable pressable"
  copyable-value="Quick feedback copy"
  copyable-feedback-duration="500"&gt;
  &lt;span class="copy-label"&gt;Quick feedback copy&lt;/span&gt;
  &lt;span class="copy-indicator"&gt;Copy&lt;/span&gt;
&lt;/copy-demo&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Provider Pattern ── -->

    <h2>Provider Pattern <span class="pattern-badge provider">Provider</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>&lt;ui-controller&gt;</code> applies copyable to a plain <code>&lt;div&gt;</code>. No UIElement subclass needed for the target. The controller manages <code>[copied]</code> feedback; a click listener triggers <code>copy()</code>.
      </p>
      <ui-controller id="provider-ctrl" traits="copyable" copyable-value="npx create-native-ui@latest">
        <div id="provider-card" class="copy-card">
          <span class="copy-label">npx create-native-ui@latest</span>
          <span class="copy-indicator"><ui-icon name="copy"></ui-icon> Copy</span>
        </div>
      </ui-controller>
      <div id="provider-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="copyable"
  copyable-value="npx create-native-ui@latest"&gt;
  &lt;div class="copy-card"&gt;
    &lt;span class="copy-label"&gt;npx create-native-ui@latest&lt;/span&gt;
    &lt;span class="copy-indicator"&gt;Copy&lt;/span&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── API Reference ── -->

    <h2>API</h2>

    <div class="api-section">
      <h3>Adapter Options (<code>copyable-*</code>)</h3>
      <table class="api-table">
        <thead><tr><th>Attribute</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>copyable-value</code></td>
            <td><code>string</code></td>
            <td><code>''</code></td>
            <td>The static string to copy. For dynamic values, use <code>CopyController</code> directly with a getter function.</td>
          </tr>
          <tr>
            <td><code>copyable-feedback-duration</code></td>
            <td><code>number</code></td>
            <td><code>2000</code></td>
            <td>Duration in milliseconds that the <code>[copied]</code> attribute remains set after a successful copy.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Controller Methods</h3>
      <table class="api-table">
        <thead><tr><th>Method</th><th>Returns</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>copy()</code></td>
            <td><code>Promise&lt;void&gt;</code></td>
            <td>Writes the value to the clipboard, sets <code>[copied]</code>, and dispatches <code>ui-copy</code>.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Events</h3>
      <table class="api-table">
        <thead><tr><th>Event</th><th>Detail</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>ui-copy</code></td>
            <td><code set:html={eventDetail} /></td>
            <td>Fired after a successful copy. <code>detail.value</code> contains the copied string.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>CSS</h3>
      <table class="api-table">
        <thead><tr><th>Selector</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>[copied]</code></td>
            <td>Present on the element during the feedback window after a successful copy. Use for visual confirmation styling.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
import { Trait } from "@nonoun/native-ui";
import '../../scripts/copy-buttons';
import { logAppend as appendLog } from '../../scripts/event-log';
// ── Minimal UIElement shell for injection demos ──

      class CopyDemo extends UIElement {}
      define('copy-demo', CopyDemo);

      // ── Basic Copy (injection) — wire ui-press → copy ──

      for (const el of document.querySelectorAll('copy-demo[traits*="copyable"]')) {
        el.addEventListener('ui-press', () => {
          el.getTraitController('copyable')?.copy();
        });
      }

      const basicLogEl = document.getElementById('basic-log');
      document.querySelector('copy-demo[copyable-value="npm install native-ui"]').addEventListener('ui-copy', (e) => {
        appendLog(basicLogEl, `Copied: "${e.detail.value}"`);
      });

      // ── Copy with Getter (CopyController direct) ──

      const getterEl = document.getElementById('getter-demo');
      const getterCopy = new CopyController(getterEl, {
        value: () => new Date().toISOString(),
      });

      getterEl.addEventListener('ui-press', () => getterCopy.copy());

      const getterLogEl = document.getElementById('getter-log');
      getterEl.addEventListener('ui-copy', (e) => {
        appendLog(getterLogEl, `Copied: "${e.detail.value}"`);
      });

      // ── Custom Duration (injection) — log ──

      const fastLogEl = document.getElementById('fast-log');
      document.querySelector('copy-demo[copyable-feedback-duration="500"]').addEventListener('ui-copy', (e) => {
        appendLog(fastLogEl, `Copied: "${e.detail.value}"`);
      });

      // ── Provider Pattern — wire click → copy ──
      // The CopyController is managed by ui-controller on the first child.
      // Since targets are plain divs (not UIElement), we read the value from
      // the controller attribute and invoke clipboard API directly.

      const providerCard = document.getElementById('provider-card');
      providerCard.addEventListener('click', async () => {
        const value = document.getElementById('provider-ctrl').getAttribute('copyable-value') ?? '';
        await navigator.clipboard.writeText(value);
        providerCard.toggleAttribute('copied', true);
        setTimeout(() => providerCard.removeAttribute('copied'), 2000);
        providerCard.dispatchEvent(new CustomEvent('ui-copy', { bubbles: true, detail: { value } }));
      });

      const providerLogEl = document.getElementById('provider-log');
      providerCard.addEventListener('ui-copy', (e) => {
        appendLog(providerLogEl, `Copied: "${e.detail.value}"`);
      });
  </script>
  <style is:global>
    /* ── Copy Cards ── */

    .copy-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: 0.375rem;
      cursor: pointer;
      user-select: none;
      transition: border-color 150ms ease, background 150ms ease, color 150ms ease;
      font-size: 0.875rem;
    }

    .copy-card:hover {
      border-color: var(--neutral-border);
    }

    .copy-card[copied] {
      border-color: var(--accent-border);
      background: var(--accent-surface);
      color: var(--accent-surface-ink);
    }

    .copy-indicator {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      transition: color 150ms ease;
    }

    [copied] .copy-indicator {
      color: var(--accent-surface-ink);
    }

    .copy-label {
      flex: 1;
    }

    .output {
      font-family: monospace;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      max-height: 6rem;
      overflow-y: auto;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: var(--neutral-panel);
      border-radius: 0.25rem;
    }

    /* ── Code Blocks ── */

    /* ── Pattern Badges ── */

    .pattern-badge {
      display: inline-block;
      font-size: 0.625rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.125rem 0.5rem;
      border-radius: 9999px;
      margin-left: 0.5rem;
      vertical-align: middle;
    }

    .pattern-badge.injection {
      background: var(--accent-surface);
      color: var(--accent-surface-ink);
    }

    .pattern-badge.provider {
      background: var(--info-surface);
      color: var(--info-surface-ink);
    }

    /* ── API Reference ── */

    .api-section {
      margin-bottom: 1.5rem;
    }

    .api-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8125rem;
    }

    .api-table th {
      text-align: left;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-bottom: 2px solid var(--neutral-border-muted);
      color: var(--neutral-ink-strong);
    }

    .api-table td {
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--neutral-border-muted);
      vertical-align: top;
    }

    .api-table code {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--neutral-panel);
      padding: 0.0625rem 0.3125rem;
      border-radius: 0.1875rem;
    }

    .api-table td:first-child code {
      white-space: nowrap;
    }
</style>

</SidebarLayout>

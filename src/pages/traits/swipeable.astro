---
import SidebarLayout from '../../layouts/SidebarLayout.astro';

const codeExamples = {
  horizontalSwipeProvider: `&lt;ui-controller traits="swipeable"
  swipeable-axis="horizontal"&gt;
  &lt;div class="swipe-card"&gt;
    &lt;span class="swipe-label"&gt;Swipe Left or Right&lt;/span&gt;
    &lt;span class="swipe-hint"&gt;Click and drag horizontally&lt;/span&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

card.addEventListener('ui-swipe', (e) =&gt; {
  const { direction, distance, velocity } = e.detail;
});`,
  swipecontrollerAttachToAnyElement: `import { SwipeController } from '@nonoun/native-ui';

const card = document.querySelector('#my-card');
const swipe = new SwipeController(card, {
  threshold: 50,
  velocityThreshold: 0.3,
  axis: 'both',
});

card.addEventListener('ui-swipe', (e) =&gt; {
  const { direction, distance, velocity } = e.detail;
  log(\`\${direction} — \${distance}px @ \${velocity.toFixed(2)}px/ms\`);
});

// Later: swipe.disabled = true;
// Later: swipe.destroy();`,
};
const detailSwipe = `{ direction, distance, velocity }`;
---
<SidebarLayout title="Swipeable">
  <main>
<h1>Swipeable</h1>
    <p style="color: var(--neutral-ink-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
      Touch/pointer swipe gesture recognition with direction, velocity, and threshold. Supports horizontal, vertical, and both axes.
    </p>

    <!-- ── Horizontal Swipe (Provider) ── -->

    <h2>Horizontal Swipe <span class="pattern-badge provider">Provider</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Default axis. <code>&lt;ui-controller&gt;</code> applies swipeable to the first child. Detects left and right swipes. Click and drag horizontally.
      </p>
      <ui-controller traits="swipeable" swipeable-axis="horizontal">
        <div id="h-card" class="swipe-card">
          <span class="swipe-label">Swipe Left or Right</span>
          <span class="swipe-hint">Click and drag horizontally</span>
        </div>
      </ui-controller>
      <div id="h-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.horizontalSwipeProvider} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Vertical Swipe (Provider) ── -->

    <h2>Vertical Swipe <span class="pattern-badge provider">Provider</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Axis set to <code>'vertical'</code>. Detects up and down swipes.
      </p>
      <ui-controller traits="swipeable" swipeable-axis="vertical">
        <div id="v-card" class="swipe-card">
          <span class="swipe-label">Swipe Up or Down</span>
          <span class="swipe-hint">Click and drag vertically</span>
        </div>
      </ui-controller>
      <div id="v-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="swipeable"
  swipeable-axis="vertical"&gt;
  &lt;div class="swipe-card"&gt;
    &lt;span class="swipe-label"&gt;Swipe Up or Down&lt;/span&gt;
    &lt;span class="swipe-hint"&gt;Click and drag vertically&lt;/span&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Both Axes (Provider) ── -->

    <h2>Both Axes <span class="pattern-badge provider">Provider</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Axis set to <code>'both'</code>. Detects the dominant direction from the gesture.
      </p>
      <ui-controller traits="swipeable" swipeable-axis="both">
        <div id="b-card" class="swipe-card">
          <span class="swipe-label">Swipe Any Direction</span>
          <span class="swipe-hint">Click and drag in any direction</span>
        </div>
      </ui-controller>
      <div id="b-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="swipeable"
  swipeable-axis="both"&gt;
  &lt;div class="swipe-card"&gt;
    &lt;span class="swipe-label"&gt;Swipe Any Direction&lt;/span&gt;
    &lt;span class="swipe-hint"&gt;Click and drag in any direction&lt;/span&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Custom Threshold (Provider) ── -->

    <h2>Custom Threshold <span class="pattern-badge provider">Provider</span></h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Higher threshold (<strong>100px</strong>) and velocity (<strong>0.5 px/ms</strong>). Requires a longer, faster swipe to trigger.
      </p>
      <ui-controller traits="swipeable" swipeable-axis="horizontal" swipeable-threshold="100" swipeable-velocity-threshold="0.5">
        <div id="c-card" class="swipe-card">
          <span class="swipe-label">Swipe Hard</span>
          <span class="swipe-hint">Requires 100px distance and 0.5 px/ms velocity</span>
        </div>
      </ui-controller>
      <div id="c-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="swipeable"
  swipeable-axis="horizontal"
  swipeable-threshold="100"
  swipeable-velocity-threshold="0.5"&gt;
  &lt;div class="swipe-card"&gt;
    &lt;span class="swipe-label"&gt;Swipe Hard&lt;/span&gt;
    &lt;span class="swipe-hint"&gt;Requires 100px / 0.5 px/ms&lt;/span&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── SwipeController Direct ── -->

    <h2>SwipeController — Attach to Any Element</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Use <code>SwipeController</code> directly on any element without the trait adapter or <code>&lt;ui-controller&gt;</code>.
      </p>
      <div id="controller-card" class="swipe-card">
        <span class="swipe-label">Swipe Here</span>
        <span class="swipe-hint">SwipeController attached to a plain div</span>
      </div>
      <div id="ctrl-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.swipecontrollerAttachToAnyElement} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── API Reference ── -->

    <h2>API</h2>

    <div class="api-section">
      <h3>Adapter Options (<code>swipeable-*</code>)</h3>
      <table class="api-table">
        <thead><tr><th>Attribute</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>swipeable-threshold</code></td>
            <td><code>number</code></td>
            <td><code>50</code></td>
            <td>Minimum distance in pixels for a swipe to be recognized.</td>
          </tr>
          <tr>
            <td><code>swipeable-velocity-threshold</code></td>
            <td><code>number</code></td>
            <td><code>0.3</code></td>
            <td>Minimum velocity in px/ms for a swipe to be recognized.</td>
          </tr>
          <tr>
            <td><code>swipeable-axis</code></td>
            <td><code>'horizontal' | 'vertical' | 'both'</code></td>
            <td><code>'horizontal'</code></td>
            <td>Which axis to detect swipes on. <code>'both'</code> picks the dominant axis.</td>
          </tr>
          <tr>
            <td><code>swipeable-disabled</code></td>
            <td><code>boolean</code></td>
            <td><code>false</code></td>
            <td>Disables swipe detection when true.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Controller Properties</h3>
      <table class="api-table">
        <thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>direction</code></td>
            <td><code>'left' | 'right' | 'up' | 'down' | null</code></td>
            <td>Direction of the last recognized swipe.</td>
          </tr>
          <tr>
            <td><code>distance</code></td>
            <td><code>number</code></td>
            <td>Distance in pixels of the last recognized swipe.</td>
          </tr>
          <tr>
            <td><code>velocity</code></td>
            <td><code>number</code></td>
            <td>Velocity in px/ms of the last recognized swipe.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Events</h3>
      <table class="api-table">
        <thead><tr><th>Event</th><th>Detail</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>ui-swipe</code></td>
            <td><code set:html={detailSwipe} /></td>
            <td>Fired when a swipe gesture meets the threshold and velocity requirements.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>CSS Attributes</h3>
      <table class="api-table">
        <thead><tr><th>Attribute</th><th>Set on</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>[swiping]</code></td>
            <td>Host element</td>
            <td>Present while the pointer is down (gesture in progress).</td>
          </tr>
          <tr>
            <td><code>[swipe-left]</code></td>
            <td>Host element</td>
            <td>Set briefly (300ms) after a left swipe is recognized.</td>
          </tr>
          <tr>
            <td><code>[swipe-right]</code></td>
            <td>Host element</td>
            <td>Set briefly (300ms) after a right swipe is recognized.</td>
          </tr>
          <tr>
            <td><code>[swipe-up]</code></td>
            <td>Host element</td>
            <td>Set briefly (300ms) after an up swipe is recognized.</td>
          </tr>
          <tr>
            <td><code>[swipe-down]</code></td>
            <td>Host element</td>
            <td>Set briefly (300ms) after a down swipe is recognized.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
// ── Copy buttons ──

      for (const btn of document.querySelectorAll('.copy-btn')) {
        btn.addEventListener('click', async () => {
          const code = btn.closest('.layout-code')?.querySelector('code');
          if (!code) return;
          await navigator.clipboard.writeText(code.textContent);
          const icon = btn.querySelector('ui-icon');
          if (icon) {
            icon.setAttribute('name', 'check');
            setTimeout(() => { icon.setAttribute('name', 'copy'); }, 1500);
          }
        });
      }

      // ── Helper: event logging ──

      function appendLog(el, msg) {
        if (!el) return;
        const line = document.createElement('div');
        line.textContent = msg;
        el.appendChild(line);
        el.scrollTop = el.scrollHeight;
        while (el.children.length > 20) el.removeChild(el.firstChild);
      }

      // ── Horizontal Swipe (provider) ──

      const hCard = document.getElementById('h-card');
      const hLogEl = document.getElementById('h-log');
      hCard.addEventListener('ui-swipe', (e) => {
        const { direction, distance, velocity } = e.detail;
        appendLog(hLogEl, `${direction} — ${Math.round(distance)}px @ ${velocity.toFixed(2)}px/ms`);
      });

      // ── Vertical Swipe (provider) ──

      const vCard = document.getElementById('v-card');
      const vLogEl = document.getElementById('v-log');
      vCard.addEventListener('ui-swipe', (e) => {
        const { direction, distance, velocity } = e.detail;
        appendLog(vLogEl, `${direction} — ${Math.round(distance)}px @ ${velocity.toFixed(2)}px/ms`);
      });

      // ── Both Axes (provider) ──

      const bCard = document.getElementById('b-card');
      const bLogEl = document.getElementById('b-log');
      bCard.addEventListener('ui-swipe', (e) => {
        const { direction, distance, velocity } = e.detail;
        appendLog(bLogEl, `${direction} — ${Math.round(distance)}px @ ${velocity.toFixed(2)}px/ms`);
      });

      // ── Custom Threshold (provider) ──

      const cCard = document.getElementById('c-card');
      const cLogEl = document.getElementById('c-log');
      cCard.addEventListener('ui-swipe', (e) => {
        const { direction, distance, velocity } = e.detail;
        appendLog(cLogEl, `${direction} — ${Math.round(distance)}px @ ${velocity.toFixed(2)}px/ms`);
      });

      // ── SwipeController — attach to plain element ──

      const ctrlCard = document.getElementById('controller-card');
      const swipe = new SwipeController(ctrlCard, {
        threshold: 50,
        velocityThreshold: 0.3,
        axis: 'both',
      });

      const ctrlLogEl = document.getElementById('ctrl-log');
      ctrlCard.addEventListener('ui-swipe', (e) => {
        const { direction, distance, velocity } = e.detail;
        appendLog(ctrlLogEl, `${direction} — ${Math.round(distance)}px @ ${velocity.toFixed(2)}px/ms`);
      });
  </script>
  <style is:global>
    /* ── Swipe Cards ── */

    .swipe-card {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
      min-height: 8rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: var(--_radius);
      touch-action: none;
      user-select: none;
      cursor: grab;
      transition: background 200ms ease, border-color 200ms ease;
    }

    .swipe-card[swiping] {
      background: var(--accent-surface);
      border-color: var(--accent-border);
      cursor: grabbing;
    }

    .swipe-card[swipe-left],
    .swipe-card[swipe-right],
    .swipe-card[swipe-up],
    .swipe-card[swipe-down] {
      background: var(--accent-surface);
      border-color: var(--accent-border);
    }

    .swipe-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--neutral-ink-strong);
    }

    .swipe-hint {
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
    }

    .swipe-direction {
      display: flex;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
    }

    .swipe-direction span {
      padding: 0.125rem 0.5rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: 0.25rem;
    }

    .output {
      font-family: monospace;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      max-height: 6rem;
      overflow-y: auto;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: var(--neutral-panel);
      border-radius: 0.25rem;
    }

    /* ── Code Blocks ── */




    /* ── Pattern Badges ── */

    .pattern-badge {
      display: inline-block;
      font-size: 0.625rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.125rem 0.5rem;
      border-radius: 9999px;
      margin-left: 0.5rem;
      vertical-align: middle;
    }

    .pattern-badge.provider {
      background: var(--info-surface);
      color: var(--info-surface-ink);
    }

    /* ── API Reference ── */

    .api-section {
      margin-bottom: 1.5rem;
    }

    .api-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8125rem;
    }

    .api-table th {
      text-align: left;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-bottom: 2px solid var(--neutral-border-muted);
      color: var(--neutral-ink-strong);
    }

    .api-table td {
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--neutral-border-muted);
      vertical-align: top;
    }

    .api-table code {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--neutral-panel);
      padding: 0.0625rem 0.3125rem;
      border-radius: 0.1875rem;
    }

    .api-table td:first-child code {
      white-space: nowrap;
    }
</style>

</SidebarLayout>

---
import SidebarLayout from '../../layouts/SidebarLayout.astro';

const codeExamples = {
  customDuration500ms: `&lt;!-- Custom animation duration (default: 200ms) --&gt;
&lt;ui-controller traits="collapsible" collapsible-duration="500"&gt;
  &lt;div&gt;
    &lt;p&gt;Slower 500ms animation&lt;/p&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

&lt;!-- Imperative: CollapsibleController --&gt;
&lt;script&gt;
  import { CollapsibleController } from '@nonoun/native-ui';

  const ctrl = new CollapsibleController(hostElement, {
    duration: 500
  });
  ctrl.toggle();
&lt;/script&gt;`,
};
---
<SidebarLayout title="Collapsible">
  <main>
<h1>Collapsible</h1>
    <p style="color: var(--neutral-ink-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
      Composable trait for animated show/hide with smooth height transitions. Dispatches <code>ui-expand</code> and <code>ui-collapse</code> events.
    </p>

    <!-- ── Basic Toggle ── -->

    <h2>Basic Toggle</h2>
    <div class="layout-section">
      <ui-button id="toggle-btn">Toggle Content</ui-button>
      <collapse-demo traits="collapsible" id="section1">
        <div class="collapse-content">
          <p>This content smoothly animates open and closed using the Collapsible trait.</p>
          <p>The height transition is calculated dynamically from the content's natural scroll height.</p>
        </div>
      </collapse-demo>
      <div id="log"></div>
    <pre class="layout-code"><code>&lt;!-- Declarative: ui-controller with collapsible trait --&gt;
&lt;ui-controller traits="collapsible"&gt;
  &lt;div id="my-section"&gt;
    &lt;p&gt;Collapsible content here&lt;/p&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

&lt;script&gt;
  // Toggle programmatically
  const el = document.getElementById('my-section');
  el.getTraitController('collapsible').toggle();

  // Listen for events
  el.addEventListener('ui-expand', () =&gt; console.log('Expanded'));
  el.addEventListener('ui-collapse', () =&gt; console.log('Collapsed'));
&lt;/script&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Initially Collapsed ── -->

    <h2>Initially Collapsed</h2>
    <div class="layout-section">
      <ui-button id="expand-btn">Expand</ui-button>
      <collapse-demo traits="collapsible" id="section2" collapsed>
        <div class="collapse-content">
          <p>I was hidden on page load. Click "Expand" to reveal me with a smooth animation.</p>
        </div>
      </collapse-demo>
    <pre class="layout-code"><code>&lt;!-- Start collapsed with the collapsed attribute --&gt;
&lt;ui-controller traits="collapsible"&gt;
  &lt;div collapsed&gt;
    &lt;p&gt;Hidden on page load&lt;/p&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

&lt;script&gt;
  // Expand/collapse individually
  const ctrl = el.getTraitController('collapsible');
  if (ctrl.collapsed) ctrl.expand();
  else ctrl.collapse();
&lt;/script&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Custom Duration ── -->

    <h2>Custom Duration (500ms)</h2>
    <div class="layout-section">
      <ui-button id="slow-btn">Toggle Slow</ui-button>
      <collapse-demo traits="collapsible" collapsible-duration="500" id="section3">
        <div class="collapse-content">
          <p>This section uses a custom <code>collapsible-duration="500"</code> for a slower, more dramatic animation.</p>
        </div>
      </collapse-demo>
    <pre class="layout-code"><code set:html={codeExamples.customDuration500ms} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── API Reference ── -->

    <h2>API</h2>
    <div class="layout-section" style="padding: 0; border: none; background: none;">
      <table style="width: 100%; border-collapse: collapse; font-size: 0.8125rem;">
        <thead>
          <tr>
            <th style="text-align: left; padding: 0.5rem 0.75rem; border-bottom: 2px solid var(--neutral-border-muted); color: var(--neutral-ink-strong);">Property / Method</th>
            <th style="text-align: left; padding: 0.5rem 0.75rem; border-bottom: 2px solid var(--neutral-border-muted); color: var(--neutral-ink-strong);">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>toggle()</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Toggle between expanded and collapsed</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>expand()</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Expand the content</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>collapse()</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Collapse the content</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>collapsed</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Boolean — current collapsed state</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>collapsible-duration</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Animation duration in ms (default: 200)</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>ui-expand</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Event dispatched after expand animation completes</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);"><code>ui-collapse</code></td>
            <td style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--neutral-border-muted);">Event dispatched after collapse animation completes</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
// ── Minimal UIElement shell for injection demos ──
      // No custom logic — traits="collapsible" does all the work.
      // getTraitController('collapsible') provides programmatic access.

      class CollapseDemo extends UIElement {}
      define('collapse-demo', CollapseDemo);

      // ── Event logging ──

      const logEl = document.getElementById('log');
      let count = 0;
      function log(msg) {
        count++;
        const line = document.createElement('div');
        line.textContent = `#${count} ${msg}`;
        logEl.appendChild(line);
        logEl.scrollTop = logEl.scrollHeight;
      }

      // ── Basic toggle ──

      const section1 = document.getElementById('section1');
      document.getElementById('toggle-btn').addEventListener('ui-press', () => {
        section1.getTraitController('collapsible').toggle();
      });
      section1.addEventListener('ui-expand', () => log('Expanded'));
      section1.addEventListener('ui-collapse', () => log('Collapsed'));

      // ── Initially collapsed ──

      const section2 = document.getElementById('section2');
      document.getElementById('expand-btn').addEventListener('ui-press', () => {
        const ctrl = section2.getTraitController('collapsible');
        if (ctrl.collapsed) {
          ctrl.expand();
        } else {
          ctrl.collapse();
        }
      });

      // ── Custom duration (500ms) ──

      const section3 = document.getElementById('section3');
      document.getElementById('slow-btn').addEventListener('ui-press', () => {
        section3.getTraitController('collapsible').toggle();
      });
// ── Copy buttons ──

      for (const btn of document.querySelectorAll('.copy-btn')) {
        btn.addEventListener('click', async () => {
          const code = btn.closest('.layout-code')?.querySelector('code');
          if (!code) return;
          await navigator.clipboard.writeText(code.textContent);
          const icon = btn.querySelector('ui-icon');
          if (icon) {
            icon.setAttribute('name', 'check');
            setTimeout(() => { icon.setAttribute('name', 'copy'); }, 1500);
          }
        });
      }
  </script>
  <style is:global>
    .collapse-section {
      display: block;
      overflow: hidden;
    }

    .collapse-section[collapsed] {
      height: 0;
      overflow: clip;
    }

    .collapse-content {
      padding: 1rem;
      background: var(--accent-surface);
      color: var(--accent-surface-ink);
      border-radius: 0.5rem;
      margin-top: 0.75rem;
      font-size: 0.875rem;
      line-height: 1.5;
    }

    #log {
      font-family: monospace;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      max-height: 8rem;
      overflow-y: auto;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: var(--neutral-panel);
      border-radius: 0.25rem;
    }

    /* ── Code Blocks ── */
</style>

</SidebarLayout>

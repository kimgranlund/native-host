---
import SidebarLayout from '../../layouts/SidebarLayout.astro';

const codeExamples = {
  multipleSelection: `&lt;ui-controller
  traits="selectable"
  selectable-selector=".select-item"
  selectable-mode="multiple"
&gt;
  &lt;div class="select-list"&gt;
    &lt;div class="select-item"&gt;Design System&lt;/div&gt;
    &lt;div class="select-item"&gt;Typography&lt;/div&gt;
    &lt;div class="select-item"&gt;Color Tokens&lt;/div&gt;
    &lt;div class="select-item"&gt;Layout Grid&lt;/div&gt;
    &lt;div class="select-item"&gt;Components&lt;/div&gt;
    &lt;div class="select-item"&gt;Accessibility&lt;/div&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

list.addEventListener('ui-selection-change', (e) =&gt; {
  const { selected, count } = e.detail;
  log(\`Selected \${count} item(s)\`);
});`,
  singleSelection: `&lt;ui-controller
  traits="selectable"
  selectable-selector=".select-item"
  selectable-mode="single"
&gt;
  &lt;div class="select-list"&gt;
    &lt;div class="select-item"&gt;Small&lt;/div&gt;
    &lt;div class="select-item"&gt;Medium&lt;/div&gt;
    &lt;div class="select-item"&gt;Large&lt;/div&gt;
    &lt;div class="select-item"&gt;Extra Large&lt;/div&gt;
  &lt;/div&gt;
&lt;/ui-controller&gt;

list.addEventListener('ui-selection-change', (e) =&gt; {
  const { selected } = e.detail;
  const name = selected[0]?.textContent ?? 'none';
  log(\`Selected: \${name}\`);
});`,
};
const detailSelectedCount = `{ selected, count }`;
const handleClickSig = `handleClick(item, { shift, ctrl })`;
---
<SidebarLayout title="Selectable">
  <main>
<h1>Selectable</h1>
    <p style="color: var(--neutral-ink-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
      Multi-selection state management with click, shift+click range, ctrl/cmd+click toggle, and ctrl/cmd+A select all.
    </p>

    <!-- ── Multiple Selection ── -->

    <h2>Multiple Selection</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Click to select, <strong>Shift+Click</strong> for range, <strong>Ctrl/Cmd+Click</strong> to toggle, <strong>Ctrl/Cmd+A</strong> to select all.
      </p>
      <ui-controller traits="selectable" selectable-selector=".select-item" selectable-mode="multiple">
        <div class="select-list">
          <div class="select-item">Design System</div>
          <div class="select-item">Typography</div>
          <div class="select-item">Color Tokens</div>
          <div class="select-item">Layout Grid</div>
          <div class="select-item">Components</div>
          <div class="select-item">Accessibility</div>
        </div>
      </ui-controller>
      <div id="multi-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.multipleSelection} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Single Selection ── -->

    <h2>Single Selection</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Mode set to <code>'single'</code>. Only one item can be selected at a time.
      </p>
      <ui-controller traits="selectable" selectable-selector=".select-item" selectable-mode="single">
        <div class="select-list">
          <div class="select-item">Small</div>
          <div class="select-item">Medium</div>
          <div class="select-item">Large</div>
          <div class="select-item">Extra Large</div>
        </div>
      </ui-controller>
      <div id="single-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.singleSelection} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── API Reference ── -->

    <h2>API</h2>

    <div class="api-section">
      <h3>Controller Options</h3>
      <table class="api-table">
        <thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>selector</code></td>
            <td><code>string</code></td>
            <td><code>''</code></td>
            <td>CSS selector for selectable items within the host.</td>
          </tr>
          <tr>
            <td><code>mode</code></td>
            <td><code>'single' | 'multiple'</code></td>
            <td><code>'multiple'</code></td>
            <td>Selection mode. Single allows only one item selected at a time.</td>
          </tr>
          <tr>
            <td><code>disabled</code></td>
            <td><code>boolean</code></td>
            <td><code>false</code></td>
            <td>Disables all selection behavior when true.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Controller Methods</h3>
      <table class="api-table">
        <thead><tr><th>Method</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>select(item)</code></td>
            <td>Select a single item, clearing all others.</td>
          </tr>
          <tr>
            <td><code>toggle(item)</code></td>
            <td>Toggle an item's selected state without affecting others.</td>
          </tr>
          <tr>
            <td><code>rangeTo(item)</code></td>
            <td>Select all items from the anchor to the given item.</td>
          </tr>
          <tr>
            <td><code>selectAll()</code></td>
            <td>Select all items (multiple mode only).</td>
          </tr>
          <tr>
            <td><code>clear()</code></td>
            <td>Clear all selections.</td>
          </tr>
          <tr>
            <td><code>getSelection()</code></td>
            <td>Returns an array of currently selected elements.</td>
          </tr>
          <tr>
            <td><code set:html={handleClickSig} /></td>
            <td>Process a click with modifier keys. Delegates to select/toggle/rangeTo.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Events</h3>
      <table class="api-table">
        <thead><tr><th>Event</th><th>Detail</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>ui-selection-change</code></td>
            <td><code set:html={detailSelectedCount} /></td>
            <td>Fired whenever the selection changes. <code>selected</code> is an array of elements.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>CSS Attributes</h3>
      <table class="api-table">
        <thead><tr><th>Attribute</th><th>Set on</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>[selected]</code></td>
            <td>Selected items</td>
            <td>Present on each selected item. Use for styling selected state.</td>
          </tr>
          <tr>
            <td><code>[selection-anchor]</code></td>
            <td>Anchor item</td>
            <td>Present on the anchor item used for shift+click range selection.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
import '../../scripts/copy-buttons';
import { logAppend as appendLog } from '../../scripts/event-log';

      // ── Multiple Selection ──

      const multiList = document.querySelector('ui-controller[selectable-mode="multiple"] > .select-list');
      multiList.addEventListener('ui-selection-change', (e) => {
        const { selected, count } = e.detail;
        const names = selected.map(el => el.textContent).join(', ');
        multiLog(`Selected ${count}: ${names || 'none'}`);
      });

      // ── Single Selection ──

      const singleList = document.querySelector('ui-controller[selectable-mode="single"] > .select-list');
      singleList.addEventListener('ui-selection-change', (e) => {
        const { selected } = e.detail;
        const name = selected[0]?.textContent ?? 'none';
        singleLog(`Selected: ${name}`);
      });

      const multiLogEl = document.getElementById('multi-log');
      function multiLog(msg) { appendLog(multiLogEl, msg); }

      const singleLogEl = document.getElementById('single-log');
      function singleLog(msg) { appendLog(singleLogEl, msg); }
  </script>
  <style is:global>
    /* ── Selectable Items ── */

    .select-list {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .select-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.625rem 0.75rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: 0.375rem;
      cursor: pointer;
      user-select: none;
      transition: background 150ms ease, border-color 150ms ease;
      font-size: 0.875rem;
    }

    .select-item[selected] {
      background: var(--accent-surface);
      color: var(--accent-surface-ink);
      border-color: var(--accent-border);
    }

    .select-item[selection-anchor] {
      outline: 2px solid var(--accent-border);
      outline-offset: -2px;
    }

    .output {
      font-family: monospace;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      max-height: 6rem;
      overflow-y: auto;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: var(--neutral-panel);
      border-radius: 0.25rem;
    }

    /* ── Code Blocks ── */

    /* ── API Reference ── */

    .api-section {
      margin-bottom: 1.5rem;
    }

    .api-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8125rem;
    }

    .api-table th {
      text-align: left;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-bottom: 2px solid var(--neutral-border-muted);
      color: var(--neutral-ink-strong);
    }

    .api-table td {
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--neutral-border-muted);
      vertical-align: top;
    }

    .api-table code {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--neutral-panel);
      padding: 0.0625rem 0.3125rem;
      border-radius: 0.1875rem;
    }

    .api-table td:first-child code {
      white-space: nowrap;
    }
</style>

</SidebarLayout>

---
import SidebarLayout from '../../layouts/SidebarLayout.astro';

const codeExamples = {
  fileDropZoneProvider: `&lt;ui-controller traits="droppable"&gt;
  &lt;div class="drop-zone"&gt;
    Drop files here
  &lt;/div&gt;
&lt;/ui-controller&gt;

&lt;script&gt;
  zone.addEventListener('ui-file-drop', (e) =&gt; {
    for (const file of e.detail.files) {
      console.log(file.name, file.size);
    }
  });
&lt;/script&gt;`,
  textDropProvider: `&lt;ui-controller traits="droppable"&gt;
  &lt;div class="drop-zone"&gt;
    Drop text here
  &lt;/div&gt;
&lt;/ui-controller&gt;

&lt;script&gt;
  zone.addEventListener('ui-text-drop', (e) =&gt; {
    console.log('Dropped text:', e.detail.text);
  });
&lt;/script&gt;`,
};
const detailFilesDataTransfer = `{ files, dataTransfer }`;
const detailText = `{ text }`;
---
<SidebarLayout title="Droppable">
  <main>
<h1>Droppable</h1>
    <p style="color: var(--neutral-ink-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
      External file/data drop zone using the HTML5 drag-and-drop API. Sets <code>[drop-active]</code> when a valid item is dragged over and <code>[drop-invalid]</code> when the MIME type does not match <code>droppable-accept</code>.
    </p>

    <!-- ── File Drop Zone (Provider) ── -->

    <h2>File Drop Zone (Provider)</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>&lt;ui-controller traits="droppable"&gt;</code> wraps a plain div. Drop any files onto the zone.
      </p>
      <ui-controller traits="droppable">
        <div class="drop-zone" id="files-zone">
          <span class="drop-icon">&#128193;</span>
          <span>Drop files here</span>
          <span class="drop-hint">Any file type accepted</span>
        </div>
      </ui-controller>
      <div id="files-list" class="file-list" style="display: none;"></div>
      <div id="files-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.fileDropZoneProvider} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Image Only (Provider) ── -->

    <h2>Image Only (Provider)</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>droppable-accept="image/*"</code> filter. Shows <code>[drop-invalid]</code> when a non-image is dragged over.
      </p>
      <ui-controller traits="droppable" droppable-accept="image/*">
        <div class="drop-zone" id="images-zone">
          <span class="drop-icon">&#128247;</span>
          <span>Drop images here</span>
          <span class="drop-hint">Only image files accepted</span>
        </div>
      </ui-controller>
      <div id="images-list" class="file-list" style="display: none;"></div>
      <div id="images-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="droppable" droppable-accept="image/*"&gt;
  &lt;div class="drop-zone"&gt;
    Drop images here
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Text Drop (Provider) ── -->

    <h2>Text Drop (Provider)</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        Drop plain text from a browser selection. Select text elsewhere and drag it onto the zone.
      </p>
      <ui-controller traits="droppable">
        <div class="drop-zone" id="text-zone">
          <span class="drop-icon">&#128196;</span>
          <span>Drop text here</span>
          <span class="drop-hint">Select text in your browser and drag it here</span>
        </div>
      </ui-controller>
      <div id="text-content" class="dropped-text" style="display: none;"></div>
      <div id="text-log" class="output"></div>
      <pre class="layout-code"><code set:html={codeExamples.textDropProvider} /><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── Single File (Provider) ── -->

    <h2>Single File (Provider)</h2>
    <div class="layout-section">
      <p style="font-size: 0.75rem; color: var(--neutral-ink-muted); margin-bottom: 0.75rem;">
        <code>droppable-multiple="false"</code>. Only the first file is accepted when multiple are dropped.
      </p>
      <ui-controller traits="droppable" droppable-multiple="false">
        <div class="drop-zone" id="single-zone">
          <span class="drop-icon">&#128206;</span>
          <span>Drop a single file</span>
          <span class="drop-hint">Only the first file will be accepted</span>
        </div>
      </ui-controller>
      <div id="single-list" class="file-list" style="display: none;"></div>
      <div id="single-log" class="output"></div>
      <pre class="layout-code"><code>&lt;ui-controller traits="droppable" droppable-multiple="false"&gt;
  &lt;div class="drop-zone"&gt;
    Drop a single file
  &lt;/div&gt;
&lt;/ui-controller&gt;</code><ui-button class="copy-btn" size="sm" variant="ghost" aria-label="Copy"><ui-icon name="copy"></ui-icon></ui-button></pre>
    </div>

    <!-- ── API Reference ── -->

    <h2>API</h2>

    <div class="api-section">
      <h3>Provider Usage</h3>
      <table class="api-table">
        <thead><tr><th>Attribute</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>droppable-accept</code></td>
            <td><code>string</code></td>
            <td><code>'*'</code></td>
            <td>MIME type filter (e.g. <code>'image/*'</code>, <code>'application/pdf'</code>). Uses wildcard matching.</td>
          </tr>
          <tr>
            <td><code>droppable-disabled</code></td>
            <td><code>boolean</code></td>
            <td><code>false</code></td>
            <td>Disables drop zone when true.</td>
          </tr>
          <tr>
            <td><code>droppable-multiple</code></td>
            <td><code>boolean</code></td>
            <td><code>true</code></td>
            <td>When <code>"false"</code>, only the first file from a multi-file drop is accepted.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>Events</h3>
      <table class="api-table">
        <thead><tr><th>Event</th><th>Detail</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>ui-file-drop</code></td>
            <td><code set:html={detailFilesDataTransfer} /></td>
            <td>Fired when files are dropped. <code>files</code> is an array of <code>File</code> objects.</td>
          </tr>
          <tr>
            <td><code>ui-text-drop</code></td>
            <td><code set:html={detailText} /></td>
            <td>Fired when plain text is dropped (no files in the transfer).</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="api-section">
      <h3>CSS</h3>
      <table class="api-table">
        <thead><tr><th>Selector</th><th>Description</th></tr></thead>
        <tbody>
          <tr>
            <td><code>[drop-active]</code></td>
            <td>Present when a valid item is being dragged over the zone.</td>
          </tr>
          <tr>
            <td><code>[drop-invalid]</code></td>
            <td>Present when a dragged item does not match <code>droppable-accept</code>.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
import '../../scripts/copy-buttons';

      // ── Helpers ──

      function appendLog(el, msg) {
        const line = document.createElement('div');
        line.textContent = msg;
        el.appendChild(line);
        el.scrollTop = el.scrollHeight;
      }

      function formatSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      }

      function renderFiles(listEl, files) {
        listEl.innerHTML = '';
        listEl.style.display = 'flex';
        for (const file of files) {
          const item = document.createElement('div');
          item.className = 'file-item';
          item.innerHTML = `<span class="file-name">${file.name}</span><span class="file-size">${formatSize(file.size)}</span>`;
          listEl.appendChild(item);
        }
      }

      // ── File Drop Zone ──

      const filesZone = document.getElementById('files-zone');
      filesZone.addEventListener('ui-file-drop', (e) => {
        renderFiles(document.getElementById('files-list'), e.detail.files);
        for (const file of e.detail.files) {
          appendLog(document.getElementById('files-log'), `${file.name} (${formatSize(file.size)})`);
        }
      });

      // ── Image Only ──

      const imagesZone = document.getElementById('images-zone');
      imagesZone.addEventListener('ui-file-drop', (e) => {
        renderFiles(document.getElementById('images-list'), e.detail.files);
        for (const file of e.detail.files) {
          appendLog(document.getElementById('images-log'), `${file.name} (${file.type}, ${formatSize(file.size)})`);
        }
      });

      // ── Text Drop ──

      const textZone = document.getElementById('text-zone');
      textZone.addEventListener('ui-text-drop', (e) => {
        const contentEl = document.getElementById('text-content');
        contentEl.style.display = 'block';
        contentEl.textContent = e.detail.text;
        appendLog(document.getElementById('text-log'), `Dropped ${e.detail.text.length} characters`);
      });

      // ── Single File ──

      const singleZone = document.getElementById('single-zone');
      singleZone.addEventListener('ui-file-drop', (e) => {
        renderFiles(document.getElementById('single-list'), e.detail.files);
        const file = e.detail.files[0];
        appendLog(document.getElementById('single-log'), `${file.name} (${formatSize(file.size)}) — only 1 file accepted`);
      });
  </script>
  <style is:global>
    /* ── Drop Zones ── */

    .drop-zone {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      min-height: 8rem;
      padding: 1.5rem;
      background: var(--neutral-panel);
      border: 2px dashed var(--neutral-border-muted);
      border-radius: 0.5rem;
      font-size: 0.875rem;
      color: var(--neutral-ink-muted);
      transition: border-color 200ms ease, background 200ms ease, color 200ms ease;
      text-align: center;
    }

    .drop-zone[drop-active] {
      border-color: var(--accent-border);
      background: var(--accent-surface);
      color: var(--accent-surface-ink);
    }

    #images-zone[drop-invalid] {
      border-color: var(--danger-border, #e55);
      background: var(--danger-surface, #fee);
      color: var(--danger-surface-ink, #c33);
    }

    .drop-icon {
      font-size: 1.5rem;
      opacity: 0.5;
    }

    .drop-hint {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .file-list {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.75rem;
      width: 100%;
    }

    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.75rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: 0.375rem;
      font-size: 0.8125rem;
    }

    .file-name {
      font-weight: 500;
      color: var(--neutral-ink-strong);
    }

    .file-size {
      color: var(--neutral-ink-muted);
      font-size: 0.75rem;
    }

    .dropped-text {
      margin-top: 0.75rem;
      padding: 0.75rem;
      background: var(--neutral-panel);
      border: 1px solid var(--neutral-border-muted);
      border-radius: 0.375rem;
      font-size: 0.8125rem;
      color: var(--neutral-ink);
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 6rem;
      overflow-y: auto;
    }

    .output {
      font-family: monospace;
      font-size: 0.75rem;
      color: var(--neutral-ink-muted);
      max-height: 6rem;
      overflow-y: auto;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: var(--neutral-panel);
      border-radius: 0.25rem;
    }

    /* ── Code Blocks ── */




    /* ── API Reference ── */

    .api-section {
      margin-bottom: 1.5rem;
    }

    .api-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8125rem;
    }

    .api-table th {
      text-align: left;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-bottom: 2px solid var(--neutral-border-muted);
      color: var(--neutral-ink-strong);
    }

    .api-table td {
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--neutral-border-muted);
      vertical-align: top;
    }

    .api-table code {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--neutral-panel);
      padding: 0.0625rem 0.3125rem;
      border-radius: 0.1875rem;
    }

    .api-table td:first-child code {
      white-space: nowrap;
    }
</style>

</SidebarLayout>

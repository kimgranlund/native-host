---
import SidebarLayout from '../../layouts/SidebarLayout.astro';
---
<SidebarLayout title="A2UI Components">
  <main>
<div class="nav-main">
        <h1>A2UI Styled Components</h1>
        <p style="color: var(--neutral-ink-muted); margin-bottom: 1.5rem; font-size: 0.8125rem;">
          All components below are rendered through the A2UI protocol adapter into the chat panel.
          Each element carries a <code>[data-a2ui]</code> attribute and is styled via <code>a2ui.css</code>.
        </p>
      </div>
  </main>

  <script>
import { Kernel, resetKernel } from "@nonoun/native-ui/kernel";
// Icons used in this demo + icons stamped internally by components

      // ── Boot ──
      resetKernel();
      const kernel = new Kernel({ allowUnregistered: true });
      const messages = [];
      // WHY: UILayout.setup() is async — wait for the chat panel to exist.
      const layout = document.querySelector('ui-layout');
      await customElements.whenDefined('ui-layout');
      const chatPanel = await new Promise(resolve => {
        const check = () => {
          const el = layout.chatPanel;
          if (el) return resolve(el);
          requestAnimationFrame(check);
        };
        check();
      });
      const target = chatPanel.querySelector('ui-chat-content');

      const adapter = createA2UIAdapter(kernel, {
        onClientMessage: (msg) => {
          messages.push(msg);
          console.log('[A2UI Client →]', JSON.stringify(msg, null, 2));
        },
        onRender: () => {
          chatPanel.setAttribute('open', '');
        },
      });

      // ── Demo Surfaces ──

      // 1. Text Variants
      adapter.receive({
        updateComponents: {
          surfaceId: 'text-demo',
          components: [
            { id: 'root', component: 'Column', children: ['h1', 'h2', 'h3', 'body', 'caption'] },
            { id: 'h1', component: 'Text', text: 'Heading 1', variant: 'h1' },
            { id: 'h2', component: 'Text', text: 'Heading 2', variant: 'h2' },
            { id: 'h3', component: 'Text', text: 'Heading 3', variant: 'h3' },
            { id: 'body', component: 'Text', text: 'Body text — the quick brown fox jumps over the lazy dog.' },
            { id: 'caption', component: 'Text', text: 'Caption text — secondary information', variant: 'caption' },
          ],
        },
      }, target);

      // 2. Buttons
      adapter.receive({
        updateComponents: {
          surfaceId: 'buttons-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'row'] },
            { id: 'label', component: 'Text', text: 'Buttons', variant: 'h3' },
            { id: 'row', component: 'Row', children: ['primary', 'default', 'ghost', 'disabled'] },
            { id: 'primary', component: 'Button', text: 'Primary', variant: 'primary', action: { event: { name: 'click' } } },
            { id: 'default', component: 'Button', text: 'Default', action: { event: { name: 'click' } } },
            { id: 'ghost', component: 'Button', text: 'Ghost', variant: 'borderless', action: { event: { name: 'click' } } },
            { id: 'disabled', component: 'Button', text: 'Disabled', disabled: true },
          ],
        },
      }, target);

      // 3. Form Fields
      adapter.receive({
        updateComponents: {
          surfaceId: 'form-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'text-field', 'password', 'number', 'textarea', 'date', 'time'] },
            { id: 'label', component: 'Text', text: 'Form Fields', variant: 'h3' },
            { id: 'text-field', component: 'TextField', placeholder: 'Enter your name', label: 'Name' },
            { id: 'password', component: 'TextField', placeholder: 'Password', label: 'Password', variant: 'obscured' },
            { id: 'number', component: 'TextField', placeholder: '0', label: 'Quantity', variant: 'number' },
            { id: 'textarea', component: 'TextArea', placeholder: 'Write a message...', label: 'Message' },
            { id: 'date', component: 'DateTimeInput', label: 'Date', enableDate: true },
            { id: 'time', component: 'DateTimeInput', label: 'Time', enableTime: true },
          ],
        },
      }, target);

      // 4. Toggles
      adapter.receive({
        updateComponents: {
          surfaceId: 'toggles-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'row'] },
            { id: 'label', component: 'Text', text: 'Toggles', variant: 'h3' },
            { id: 'row', component: 'Row', children: ['check1', 'check2', 'switch1', 'switch2'] },
            { id: 'check1', component: 'CheckBox', label: 'Agree to terms' },
            { id: 'check2', component: 'CheckBox', label: 'Subscribe', disabled: true },
            { id: 'switch1', component: 'Switch', label: 'Notifications' },
            { id: 'switch2', component: 'Switch', label: 'Dark mode' },
          ],
        },
      }, target);

      // 5. Slider
      adapter.receive({
        updateComponents: {
          surfaceId: 'slider-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'slider'] },
            { id: 'label', component: 'Text', text: 'Slider', variant: 'h3' },
            { id: 'slider', component: 'Slider', min: 0, max: 100, value: 50, label: 'Volume' },
          ],
        },
      }, target);

      // 6. List
      adapter.receive({
        updateComponents: {
          surfaceId: 'list-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'list'] },
            { id: 'label', component: 'Text', text: 'List', variant: 'h3' },
            { id: 'list', component: 'List', children: ['opt1', 'opt2', 'opt3'] },
            { id: 'opt1', component: 'ListItem', label: 'Apple', value: 'apple' },
            { id: 'opt2', component: 'ListItem', label: 'Banana', value: 'banana' },
            { id: 'opt3', component: 'ListItem', label: 'Cherry', value: 'cherry' },
          ],
        },
      }, target);

      // 7. Card
      adapter.receive({
        updateComponents: {
          surfaceId: 'card-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'card'] },
            { id: 'label', component: 'Text', text: 'Card', variant: 'h3' },
            { id: 'card', component: 'Card', children: ['card-title', 'card-body', 'card-actions'] },
            { id: 'card-title', component: 'Text', text: 'Card Title', variant: 'h3' },
            { id: 'card-body', component: 'Text', text: 'This is a card rendered entirely through the A2UI protocol. The agent describes the UI declaratively and the adapter renders it using native-ui components.' },
            { id: 'card-actions', component: 'Row', children: ['save-btn', 'cancel-btn'] },
            { id: 'save-btn', component: 'Button', text: 'Save', variant: 'primary', action: { event: { name: 'save' } } },
            { id: 'cancel-btn', component: 'Button', text: 'Cancel', variant: 'borderless', action: { event: { name: 'cancel' } } },
          ],
        },
      }, target);

      // 8. Badge & Avatar
      adapter.receive({
        updateComponents: {
          surfaceId: 'badge-avatar-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'row'] },
            { id: 'label', component: 'Text', text: 'Badge & Avatar', variant: 'h3' },
            { id: 'row', component: 'Row', children: ['badge1', 'badge2', 'badge3', 'avatar1'] },
            { id: 'badge1', component: 'Badge', text: '3' },
            { id: 'badge2', component: 'Badge', text: 'New', variant: 'solid' },
            { id: 'badge3', component: 'Badge', text: '99+' },
            { id: 'avatar1', component: 'Avatar', src: 'https://i.pravatar.cc/96?u=a2ui', alt: 'User avatar' },
          ],
        },
      }, target);

      // 9. Divider
      adapter.receive({
        updateComponents: {
          surfaceId: 'divider-demo',
          components: [
            { id: 'root', component: 'Column', children: ['above', 'div1', 'below'] },
            { id: 'above', component: 'Text', text: 'Content above the divider' },
            { id: 'div1', component: 'Divider' },
            { id: 'below', component: 'Text', text: 'Content below the divider' },
          ],
        },
      }, target);

      // 10. Media
      adapter.receive({
        updateComponents: {
          surfaceId: 'media-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'img1'] },
            { id: 'label', component: 'Text', text: 'Image', variant: 'h3' },
            { id: 'img1', component: 'Image', url: 'https://picsum.photos/600/200', alt: 'Random landscape' },
          ],
        },
      }, target);

      // 11. Icon
      adapter.receive({
        updateComponents: {
          surfaceId: 'icon-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'row'] },
            { id: 'label', component: 'Text', text: 'Icon', variant: 'h3' },
            { id: 'row', component: 'Row', children: ['icon1', 'icon2', 'icon3', 'icon4'] },
            { id: 'icon1', component: 'Icon', name: 'house' },
            { id: 'icon2', component: 'Icon', name: 'gear' },
            { id: 'icon3', component: 'Icon', name: 'bell' },
            { id: 'icon4', component: 'Icon', name: 'magnifying-glass' },
          ],
        },
      }, target);

      // 12. Select (dropdown)
      adapter.receive({
        updateComponents: {
          surfaceId: 'select-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'select1'] },
            { id: 'label', component: 'Text', text: 'Select', variant: 'h3' },
            { id: 'select1', component: 'Select', label: 'Pick an option', children: ['sel-opt1', 'sel-opt2', 'sel-opt3'] },
            { id: 'sel-opt1', component: 'ListItem', label: 'Option A', value: 'a' },
            { id: 'sel-opt2', component: 'ListItem', label: 'Option B', value: 'b' },
            { id: 'sel-opt3', component: 'ListItem', label: 'Option C', value: 'c' },
          ],
        },
      }, target);

      // 13. ChoicePicker
      adapter.receive({
        updateComponents: {
          surfaceId: 'choice-picker-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'picker1'] },
            { id: 'label', component: 'Text', text: 'ChoicePicker', variant: 'h3' },
            { id: 'picker1', component: 'ChoicePicker', label: 'Pick a size', children: ['cp-opt1', 'cp-opt2', 'cp-opt3'], variant: 'mutuallyExclusive' },
            { id: 'cp-opt1', component: 'ListItem', label: 'Small', value: 'sm' },
            { id: 'cp-opt2', component: 'ListItem', label: 'Medium', value: 'md' },
            { id: 'cp-opt3', component: 'ListItem', label: 'Large', value: 'lg' },
          ],
        },
      }, target);

      // 14. Modal
      adapter.receive({
        updateComponents: {
          surfaceId: 'modal-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'open-btn', 'modal1'] },
            { id: 'label', component: 'Text', text: 'Modal', variant: 'h3' },
            { id: 'open-btn', component: 'Button', text: 'Open Modal', action: { event: { name: 'open-modal' } } },
            { id: 'modal1', component: 'Modal', children: ['modal-card'] },
            { id: 'modal-card', component: 'Card', children: ['modal-title', 'modal-body', 'modal-actions'] },
            { id: 'modal-title', component: 'Text', text: 'Dialog Title', variant: 'h3' },
            { id: 'modal-body', component: 'Text', text: 'This is a modal dialog rendered through the A2UI protocol. Click the backdrop or press Escape to close.' },
            { id: 'modal-actions', component: 'Row', children: ['close-btn'] },
            { id: 'close-btn', component: 'Button', text: 'Close', variant: 'primary', action: { event: { name: 'close-modal' } } },
          ],
        },
      }, target);

      // Wire modal open/close
      kernel.bus.on(
        (cmd) => cmd.type === 'a2ui:modal-demo:open-btn:open-modal',
        () => {
          const dialog = target.querySelector('[data-a2ui="Modal"]');
          if (dialog) dialog.showModal();
        },
      );
      kernel.bus.on(
        (cmd) => cmd.type === 'a2ui:modal-demo:close-btn:close-modal',
        () => {
          const dialog = target.querySelector('[data-a2ui="Modal"]');
          if (dialog) dialog.close();
        },
      );

      // 15. Tabs
      adapter.receive({
        updateComponents: {
          surfaceId: 'tabs-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'tabs1'] },
            { id: 'label', component: 'Text', text: 'Tabs', variant: 'h3' },
            { id: 'tabs1', component: 'Tabs', children: ['tab1', 'tab2', 'tab3'] },
            { id: 'tab1', component: 'Column', label: 'Overview', value: 'overview', children: ['tab1-text'] },
            { id: 'tab1-text', component: 'Text', text: 'This is the overview panel rendered through A2UI.' },
            { id: 'tab2', component: 'Column', label: 'Features', value: 'features', children: ['tab2-text'] },
            { id: 'tab2-text', component: 'Text', text: 'Features include roving focus, ARIA semantics, and keyboard navigation.' },
            { id: 'tab3', component: 'Column', label: 'Pricing', value: 'pricing', children: ['tab3-text'] },
            { id: 'tab3-text', component: 'Text', text: 'Pricing plans start at $0/month for open source projects.' },
          ],
        },
      }, target);

      // 16. Video
      adapter.receive({
        updateComponents: {
          surfaceId: 'video-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'video1'] },
            { id: 'label', component: 'Text', text: 'Video', variant: 'h3' },
            { id: 'video1', component: 'Video', url: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm' },
          ],
        },
      }, target);

      // 17. AudioPlayer
      adapter.receive({
        updateComponents: {
          surfaceId: 'audio-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'audio1'] },
            { id: 'label', component: 'Text', text: 'AudioPlayer', variant: 'h3' },
            { id: 'audio1', component: 'AudioPlayer', url: 'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3' },
          ],
        },
      }, target);

      // 18. Data Binding Demo
      const bindingContainer = document.createElement('div');
      target.appendChild(bindingContainer);

      adapter.receive({
        createSurface: { surfaceId: 'binding-demo' },
      }, bindingContainer);

      adapter.receive({
        updateComponents: {
          surfaceId: 'binding-demo',
          components: [
            { id: 'root', component: 'Column', children: ['label', 'greeting', 'input', 'counter-row'] },
            { id: 'label', component: 'Text', text: 'Data Binding', variant: 'h3' },
            { id: 'greeting', component: 'Text', text: { path: '/greeting' } },
            { id: 'input', component: 'TextField', value: { path: '/name' }, placeholder: 'Type a name...', label: 'Name' },
            { id: 'counter-row', component: 'Row', children: ['count-label', 'inc-btn'] },
            { id: 'count-label', component: 'Text', text: { path: '/countLabel' } },
            { id: 'inc-btn', component: 'Button', text: 'Increment', action: { event: { name: 'increment' } } },
          ],
        },
      });

      adapter.receive({
        updateDataModel: {
          surfaceId: 'binding-demo',
          value: {
            greeting: 'Hello, World!',
            name: 'World',
            count: 0,
            countLabel: 'Count: 0',
          },
        },
      });

      // Listen for increment action
      kernel.bus.on(
        (cmd) => cmd.type === 'a2ui:binding-demo:inc-btn:increment',
        () => {
          const model = adapter.getDataModel('binding-demo');
          const count = (Number(model?.count) || 0) + 1;
          adapter.receive({
            updateDataModel: {
              surfaceId: 'binding-demo',
              path: '/count',
              value: count,
            },
          });
          adapter.receive({
            updateDataModel: {
              surfaceId: 'binding-demo',
              path: '/countLabel',
              value: `Count: ${count}`,
            },
          });
        },
      );
  </script>
  <style is:global>
    .nav-main {
      padding: 2rem;
      max-width: 960px;
    }





    [data-a2ui] {
      margin-bottom: 1.5rem;
    }
</style>

</SidebarLayout>
